# UI Changes Required for Fold Simplification

## Overview

The backend has been drastically simplified from 8 memory types to a single unified memory type with hash-based storage in `fold/` directory.

---

## Removed Endpoints (delete UI code that uses these)

- `/api/attachments/*` - attachments feature removed
- `/api/team/*` - team status feature removed
- `/api/sessions/*` - AI sessions feature removed
- `/api/projects/:slug/graph/*` - graph endpoints removed (use context instead)
- All decay parameter endpoints
- All metadata repo sync endpoints

---

## Changed Memory API

### Before
8 memory types: `codebase`, `session`, `spec`, `decision`, `task`, `general`, `commit`, `pr`

### After
Single unified type with `source` field:
- `file` - Indexed from source code file
- `manual` - Created by user
- `generated` - Generated by LLM (e.g., commit summary)

### Endpoints

```
# Core Memory Endpoints (simplified)
POST   /api/projects/:slug/memories       - Create memory (no type field)
GET    /api/projects/:slug/memories       - List (filter by source, not type)
GET    /api/projects/:slug/memories/:id
PUT    /api/projects/:slug/memories/:id
DELETE /api/projects/:slug/memories/:id

# NEW: Context endpoint (replaces graph traversal)
POST   /api/projects/:slug/context/:memory_id  - Get holographic context

# Search (unchanged path, simplified params)
POST   /api/projects/:slug/search

# Links
POST   /api/projects/:slug/memories/:id/links
GET    /api/projects/:slug/memories/:id/links
DELETE /api/projects/:slug/memories/:id/links/:link_id
```

---

## Memory Model Changes

### Remove from UI forms/displays
- `memory_type` dropdown (8 options) → replace with `source` (3 options)
- `retrieval_count`, `last_accessed` fields (no decay tracking)
- `content_storage` field
- Attachment upload UI components
- Type-specific fields:
  - `line_start`, `line_end` (code range)
  - `status`, `assignee` (task fields)
  - `git_branch`, `git_commit_sha`

### Add to UI
- `keywords` display (JSON array, auto-extracted by LLM)
- `context` display (auto-generated summary of domain/purpose)
- `links` display (JSON array of related memory IDs)
- `content_hash` display (for debugging/verification)

### Memory Response Shape

```typescript
interface Memory {
  id: string;              // Content hash (16 chars)
  project_id: string;
  repository_id?: string;

  // Content reference
  content_hash: string;    // Full SHA256
  hash_prefix: string;     // First 2 chars for path

  // Source tracking
  file_path?: string;
  language?: string;
  source: 'file' | 'manual' | 'generated';

  // Metadata
  title?: string;
  author?: string;
  tags?: string[];         // Was JSON string, now array

  // Agentic metadata (NEW)
  keywords?: string[];     // Auto-extracted key terms
  context?: string;        // Summary of domain/purpose
  links?: string[];        // IDs of linked memories

  // Timestamps
  created_at: string;
  updated_at: string;
}
```

---

## Link Types

### Before
10+ types: `modifies`, `contains`, `affects`, `implements`, `decides`, `supersedes`, `references`, `related`, `parent`, `blocks`, `caused_by`

### After
4 types only:
- `related` - Semantically related (auto-generated from vector similarity)
- `references` - Explicit reference in content
- `depends_on` - Dependency relationship
- `modifies` - For generated memories that summarize file changes

### Link Response Shape

```typescript
interface MemoryLink {
  id: string;
  project_id: string;
  source_id: string;
  target_id: string;
  link_type: 'related' | 'references' | 'depends_on' | 'modifies';
  context?: string;        // Why this link exists
  created_at: string;
}
```

---

## Project Model Changes

### Remove fields
- All `metadata_repo_*` fields (metadata_repo_enabled, metadata_repo_mode, etc.)
- `repo_url` (use repositories table instead)
- `ignored_commit_authors`

### Keep fields
- `id`, `slug`, `name`, `description`, `root_path`
- `created_at`, `updated_at`

### Project Response Shape

```typescript
interface Project {
  id: string;
  slug: string;
  name: string;
  description?: string;
  root_path: string;
  created_at: string;
  updated_at: string;
}
```

---

## Search Changes

### Before
Complex `SearchParams` with decay weighting, strength scores, type filtering

### After
Simple vector search with optional filters

```typescript
interface SearchRequest {
  query: string;
  limit?: number;          // Default 10
  source?: string;         // Filter by source type
  include_context?: boolean; // Include linked memories
}

interface SearchResult {
  memory: Memory;
  content: string;         // Memory content from fold/ file
  score: number;           // Vector similarity (0-1)
  is_neighbour: boolean;   // True if found via link traversal
}
```

---

## Context API (NEW)

Replaces graph traversal with holographic context reconstruction.

```typescript
// GET /api/projects/:slug/context/:memory_id?depth=2

interface ContextResponse {
  memory: Memory;
  content: string;
  related: MemoryResponse[];  // Linked + similar memories
  depth: number;
}
```

---

## UI Components to Update

1. **Memory List/Grid** - Remove type badges, add source badges
2. **Memory Form** - Remove type selector, add source selector (3 options)
3. **Memory Detail** - Show keywords, context, links
4. **Search** - Simplify filters
5. **Project Settings** - Remove decay config, metadata repo config
6. **Navigation** - Remove Team, Sessions, Attachments sections

---

## Files to Delete/Modify

### Delete entirely
- `ui/src/pages/team/*` or team status components
- `ui/src/pages/sessions/*` or AI session components
- `ui/src/components/attachments/*`
- `ui/src/components/graph/*` (if exists)

### Modify
- Memory type selectors → source selectors
- Memory list filters
- Search components
- Project settings forms
